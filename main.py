import spacy
import csv
import os

from spacy.matcher import Matcher
from os.path import isfile, join
from os import listdir

# This cleans out the text from character that might cause issues, right now only "\n", "\t", "—" and "’"
# List to be updated throughout dev
def preprocessing(file):
    clean = []
    for line in file.read().splitlines():
        line = line.strip().replace('\t', '').replace('—', '-').replace('’', '\'')
        if line: #this will only append non empty lines
            clean.append(line)

    return clean


# loop to go through all files in the input dir, so we can analyse each text with one command
# def bibli(path):
#     all_paths = [file for file in listdir(path) if isfile(join(path,file))]
#     return all_paths

models = ["fr_core_news_sm"] #, "fr_core_news_md", "fr_core_news_lg", "fr_dep_news_trf"]
book_name = "Arsène_Lupin_gentleman-cambrioleur"
path = ".\\books\\"


# This loop will list all files in the dir books. right now all_paths is hardcoded as only one book.
# To run this all comment out the lines below
# all_paths = bibli(path)
all_paths = [book_name + ".txt"]
for book_name in all_paths:
    with open(join(path + book_name) , mode='r', encoding='utf-8') as file:
        file = preprocessing(file)

        for model in models:
            nlp = spacy.load(model)
            
            with open(".\\output\\" + book_name[:-4] + "_" + model + ".csv", mode = 'w', encoding= 'utf-8', newline='') as csvfile:
                writer = csv.DictWriter(csvfile, fieldnames=['entity', 'label', 'occurence'])
                writer.writeheader()
                entities = {}

                """The dict should look like this:
                entities = {Herlock Sholmès:{
                                            'PER': 32,
                                            'LOC': 4,}
        
                """

                # #loops through all lines adding the entities in a dictionnary
                # for line in file:   
                #     doc = nlp(line)
                #     for ent in doc.ents:
                #         # checks if the entity is already in our dictionnary
                #         if ent.text not in entities.keys():
                #             entities[ent.text] = {ent.label_: 1}
                #             entities[ent.text]["total"] = 1
                #         else:
                #             #checks if the label linked to the entity is the same if it is just add 1 occurence, 
                #             # if not adds a new key, value pair.
                #             # also counting total number of occurence so it's easier to sort out later.
                #             if ent.label_ not in entities[ent.text].keys():
                #                 entities[ent.text][ent.label_] = 1
                #                 entities[ent.text]["total"] += 1             
                #             else:
                #                 entities[ent.text][ent.label_] = entities[ent.text][ent.label_] + 1
                #                 entities[ent.text]["total"] += 1
                                
                # print(entities)
                entities = {'Arsène Lupin': {'PER': 252, 'total': 252}, 'Maurice Leblanc': {'PER': 1, 'total': 1}, 'Pierre Lafitte': {'PER': 1, 'total': 1}, 'Cie': {'LOC': 1, 'total': 1}, 'Paris': {'LOC': 18, 'total': 18}, 'Exporté de Wikisource': {'PER': 1, 'total': 1}, 'DES': {'MISC': 1, 'total': 1}, 'Reine': {'PER': 3, 'total': 3}, 'Madame Imbert': {'PER': 1, 'total': 1}, 'Herlock Sholmès': {'PER': 34, 'total': 34}, 'ARRESTATION': {'ORG': 1, 'total': 1}, 'La Provence': {'LOC': 1, 'total': 1}, 'Avez': {'LOC': 1, 'total': 2, 'PER': 1}, 'mer immense': {'LOC': 1, 'total': 1}, 'Océan': {'LOC': 4, 'total': 4}, 'R': {'MISC': 1, 'total': 2, 'PER': 1}, 'Ganimard': {'PER': 81, 'total': 81}, 'Schormann': {'PER': 1, 'total': 1}, 'Nelly Underdown': {'PER': 1, 'total': 1}, 'Andrézy': {'PER': 3, 'total': 3}, 'Nelly': {'LOC': 15, 'total': 20, 'MISC': 4, 'ORG': 1}, 'Underdown': {'PER': 1, 'total': 1}, 'Chicago': {'LOC': 1, 'total': 1}, 'Jerland': {'LOC': 5, 'total': 5}, 'Parisien': {'LOC': 1, 'total': 1}, 'Lupin': {'PER': 29, 'total': 35, 'LOC': 6}, 'monsieur R': {'MISC': 1, 'total': 1}, 'Treize': {'LOC': 1, 'total': 1}, 'marquis de Raverdan': {'PER': 2, 'total': 2}, 'Rawson': {'PER': 3, 'total': 3}, '- M. Rivolta': {'PER': 1, 'total': 1}, 'Italien': {'LOC': 1, 'total': 1}, 'Miss Nelly': {'ORG': 5, 'total': 5}, 'Rozaine': {'PER': 27, 'total': 27}, 'M.': {'PER': 6, 'total': 6}, 'miss Nelly': {'ORG': 5, 'total': 5}, 'Naïvement': {'PER': 1, 'total': 1}, 'Mes yeux': {'MISC': 1, 'total': 1}, 'Lady Jerland': {'PER': 1, 'total': 1}, 'Mes bijoux': {'MISC': 1, 'total': 1}, 'Bordeaux': {'LOC': 2, 'total': 2}, "Rozaine - c'était démontré - se": {'MISC': 1, 'total': 1}, 'Louis Rozaine': {'PER': 1, 'total': 1}, 'Provence': {'LOC': 2, 'total': 2}, 'Raverdan': {'LOC': 1, 'total': 1}, 'Heures': {'PER': 1, 'total': 1}, 'Impressionnée': {'PER': 1, 'total': 1}, 'Dussé-je': {'PER': 1, 'total': 1}, 'Atlantique': {'LOC': 1, 'total': 1}, 'Soudain': {'LOC': 2, 'total': 2}, 'Ah !': {'MISC': 20, 'total': 20}, 'Appuyé': {'PER': 1, 'total': 1}, 'Italien Rivolta': {'MISC': 1, 'total': 1}, 'Pauvre Rozaine': {'MISC': 1, 'total': 1}, 'Prenez': {'PER': 1, 'total': 1}, 'mon Dieu': {'MISC': 1, 'total': 1}, "Bernard d'Andrézy": {'PER': 2, 'total': 2}, 'Macédoine': {'LOC': 1, 'total': 1}, 'Bernard': {'MISC': 1, 'total': 1}, 'R.': {'PER': 1, 'total': 1}, 'Serais': {'LOC': 1, 'total': 1}, 'Mes actes': {'MISC': 1, 'total': 1}, 'ARSÈNE LUPIN': {'MISC': 2, 'total': 2}, 'PRISON': {'MISC': 1, 'total': 1}, 'I': {'LOC': 1, 'total': 1}, 'Jumièges': {'LOC': 1, 'total': 1}, 'Saint-Wandrille': {'LOC': 1, 'total': 1}, 'Malaquis': {'MISC': 5, 'total': 9, 'LOC': 3, 'PER': 1}, 'histoire du': {'MISC': 1, 'total': 1}, 'pays de Caux': {'LOC': 2, 'total': 2}, 'abbaye de Jumièges': {'LOC': 1, 'total': 1}, 'Agnès Sorel': {'PER': 1, 'total': 1}, 'Charles VII': {'PER': 1, 'total': 1}, 'Nathan Cahorn': {'LOC': 1, 'total': 1}, 'Satan': {'PER': 1, 'total': 1}, 'Bourse': {'LOC': 1, 'total': 1}, 'Rubens': {'LOC': 3, 'total': 3}, 'Watteau': {'PER': 3, 'total': 5, 'LOC': 2}, 'Jean Goujon': {'PER': 1, 'total': 1}, 'baron Satan': {'PER': 1, 'total': 1}, 'de la Seine': {'LOC': 1, 'total': 1}, 'Cahorn': {'LOC': 3, 'total': 8, 'ORG': 4, 'PER': 1}, 'Prison de la Santé': {'PER': 1, 'total': 1}, 'Monsieur': {'PER': 38, 'total': 38}, 'Philippe de Champaigne': {'PER': 1, 'total': 1}, 'Vos Rubens': {'PER': 1, 'total': 1}, 'Louis XIII': {'PER': 1, 'total': 1}, 'Beauvais': {'LOC': 1, 'total': 1}, 'Jacob': {'PER': 1, 'total': 1}, 'Renaissance': {'PER': 1, 'total': 2, 'LOC': 1}, 'gare des Batignolles': {'LOC': 1, 'total': 1}, 'Veuillez': {'PER': 3, 'total': 3}, 'Hôtel des Ventes': {'LOC': 1, 'total': 1}, 'Directoire': {'MISC': 1, 'total': 1}, 'Barras': {'PER': 1, 'total': 1}, 'Mémoires inédits': {'MISC': 1, 'total': 1}, 'Garat': {'LOC': 1, 'total': 1}, 'Louis XV': {'PER': 2, 'total': 2}, 'Lecteur': {'PER': 1, 'total': 1}, 'Amérique': {'LOC': 6, 'total': 6}, 'Rouen': {'LOC': 13, 'total': 13}, 'la Santé': {'LOC': 2, 'total': 3, 'MISC': 1}, 'Réveil de Caudebec': {'LOC': 1, 'total': 1}, 'Sûreté': {'PER': 3, 'total': 11, 'LOC': 8}, 'Caudebec': {'LOC': 4, 'total': 4}, 'Réveil': {'LOC': 2, 'total': 3, 'ORG': 1}, 'Tenez': {'LOC': 2, 'total': 2}, 'croyez': {'MISC': 1, 'total': 2, 'ORG': 1}, 'Batignolles': {'ORG': 1, 'total': 1}, 'Préparez': {'PER': 1, 'total': 1}, 'ARSÈNE': {'MISC': 1, 'total': 1}, '⁂': {'MISC': 22, 'total': 22}, 'barricada': {'LOC': 1, 'total': 1}, 'Onze heures': {'MISC': 1, 'total': 1}, 'Louis XVI': {'PER': 5, 'total': 5}, 'Régent !': {'ORG': 1, 'total': 1}, 'Vierge': {'PER': 1, 'total': 1}, '- Dame !': {'PER': 5, 'total': 5}, 'essayez': {'PER': 1, 'total': 1}, 'Santé !': {'MISC': 1, 'total': 1}, 'regretta': {'LOC': 1, 'total': 1}, 'Écho de France': {'MISC': 10, 'total': 12, 'LOC': 2}, 'Quels': {'PER': 1, 'total': 1}, 'Dudouis': {'PER': 4, 'total': 4}, 'Sherlock Holmès': {'PER': 1, 'total': 1}, 'Excusez': {'MISC': 2, 'total': 2}, 'affaire Cahorn': {'LOC': 3, 'total': 3}, 'Affaire Cahorn': {'PER': 1, 'total': 1}, 'château du Malaquis': {'LOC': 1, 'total': 1}, 'Seine-Inférieure': {'LOC': 1, 'total': 1}, 'Parlez': {'PER': 1, 'total': 1}, 'Z.': {'LOC': 1, 'total': 1}, 'Arsène': {'PER': 20, 'total': 20}, 'Supposons': {'MISC': 1, 'total': 1}, 'Ledit': {'PER': 1, 'total': 1}, 'Hein': {'MISC': 2, 'total': 2}, 'M. Dudouis': {'PER': 7, 'total': 7}, 'pseudo-Ganimard': {'MISC': 1, 'total': 1}, 'Machinalement Ganimard': {'PER': 1, 'total': 1}, 'Accord': {'LOC': 1, 'total': 1}, 'Comprenez': {'PER': 1, 'total': 1}, 'Mercredi': {'PER': 1, 'total': 1}, 'Pergolèse': {'LOC': 1, 'total': 1}, '- J. B': {'PER': 1, 'total': 1}, 'Jules Bouvier': {'PER': 2, 'total': 2}, 'ÉVASION': {'ORG': 1, 'total': 1}, 'u': {'MISC': 1, 'total': 1}, 'Dieuzy': {'PER': 6, 'total': 6}, 'Folenfant': {'PER': 3, 'total': 3}, 'Grand Journal': {'ORG': 1, 'total': 2, 'LOC': 1}, 'Sûreté M. Dudouis': {'PER': 1, 'total': 1}, 'Dieu': {'MISC': 9, 'total': 9}, 'le Havane': {'LOC': 1, 'total': 1}, 'Argus': {'LOC': 1, 'total': 1}, 'Presse': {'MISC': 1, 'total': 1}, 'Culte des héros de Carlyle': {'ORG': 1, 'total': 1}, "Manuel d'Épictète": {'PER': 1, 'total': 1}, 'Leyde': {'LOC': 1, 'total': 1}, 'Henri Clet': {'PER': 1, 'total': 1}, 'H-P': {'PER': 3, 'total': 5, 'LOC': 2}, 'Réponse': {'LOC': 1, 'total': 1}, 'Soyez': {'ORG': 1, 'total': 1}, 'horse power': {'PER': 1, 'total': 1}, 'greffe de la Santé': {'LOC': 1, 'total': 1}, 'Danval': {'PER': 1, 'total': 1}, 'Crédit Lyonnais': {'ORG': 3, 'total': 3}, 'Babylone': {'LOC': 1, 'total': 1}, 'Armesnil': {'LOC': 1, 'total': 1}, 'Gouret': {'LOC': 1, 'total': 1}, 'Imblevain': {'PER': 1, 'total': 1}, 'Groseillers': {'ORG': 1, 'total': 1}, 'Dépôt': {'LOC': 5, 'total': 5}, 'salade': {'PER': 1, 'total': 1}, 'Horloge': {'LOC': 1, 'total': 1}, 'Palais de Justice': {'LOC': 1, 'total': 1}, 'pont Saint-Michel': {'LOC': 1, 'total': 1}, 'plaque de tôle': {'LOC': 1, 'total': 1}, 'boulevard Saint-Michel': {'LOC': 1, 'total': 1}, 'Saint-Germain': {'ORG': 2, 'total': 3, 'LOC': 1}, 'sauta': {'LOC': 1, 'total': 1}, 'rue Soufflot': {'LOC': 1, 'total': 1}, 'rue Saint-Jacques': {'LOC': 2, 'total': 2}, 'Boulevard de Port-Royal': {'PER': 1, 'total': 1}, 'rue de la Santé': {'LOC': 2, 'total': 2}, 'prison de la Santé': {'LOC': 2, 'total': 2}, 'Soufflot': {'PER': 1, 'total': 1}, 'M. Bouvier': {'PER': 2, 'total': 2}, "croyez-m'": {'MISC': 1, 'total': 1}, 'Mon Dieu': {'MISC': 2, 'total': 2}, 'Préfet': {'MISC': 1, 'total': 1}, 'Monsieur le Préfet': {'PER': 1, 'total': 1}, 'Avocats': {'PER': 1, 'total': 1}, 'Tout-Paris': {'LOC': 1, 'total': 1}, 'Me Danval': {'PER': 1, 'total': 1}, 'Baudru': {'PER': 16, 'total': 16}, 'Désiré': {'PER': 3, 'total': 3}, 'Rostat': {'MISC': 1, 'total': 1}, 'Dickson': {'PER': 1, 'total': 1}, 'hôpital Saint-Louis': {'LOC': 1, 'total': 1}, "Grand Prix de l'Exposition": {'MISC': 1, 'total': 1}, 'Bazar de la Charité': {'MISC': 1, 'total': 1}, "l'Europe": {'LOC': 1, 'total': 1}, 'de la Santé': {'PER': 1, 'total': 2, 'LOC': 1}, 'gardiens de la Santé': {'ORG': 1, 'total': 1}, '- Dame': {'PER': 3, 'total': 3}, 'Baudru Désiré': {'PER': 4, 'total': 4}, 'Trompés': {'PER': 1, 'total': 1}, 'Désiré Baudru': {'PER': 1, 'total': 1}, 'Courbevoie': {'LOC': 1, 'total': 1}, 'Asnières': {'LOC': 1, 'total': 1}, 'Levallois': {'LOC': 1, 'total': 1}, 'Ternes': {'LOC': 2, 'total': 2}, 'Baudru libre': {'PER': 1, 'total': 1}, 'Seine': {'LOC': 2, 'total': 2}, 'Châtelet': {'LOC': 1, 'total': 1}, 'rue Saint-Martin': {'LOC': 1, 'total': 1}, 'Batignolles-Jardin des Plantes': {'LOC': 1, 'total': 1}, 'rue de Rivoli': {'LOC': 1, 'total': 1}, 'Galeries-Lafayette': {'ORG': 1, 'total': 1}, 'Muette': {'LOC': 2, 'total': 2}, 'boulevard Haussmann': {'LOC': 1, 'total': 1}, 'Victor-Hugo': {'LOC': 1, 'total': 1}, 'bois de Boulogne': {'LOC': 1, 'total': 1}, 'Auteuil': {'LOC': 2, 'total': 2}, 'Assises': {'ORG': 1, 'total': 1}, 'Orfèvres': {'MISC': 1, 'total': 1}, 'udi-shi-ghi': {'ORG': 1, 'total': 1}, 'Saint-Louis': {'LOC': 1, 'total': 1}, 'Altier': {'LOC': 1, 'total': 1}, 'Joignez': {'PER': 1, 'total': 1}, 'Mes': {'PER': 1, 'total': 1}, 'Logiquement': {'PER': 1, 'total': 1}, 'Bertillon': {'LOC': 1, 'total': 1}, 'exclama Lupin': {'PER': 1, 'total': 1}, 'Hélas !': {'MISC': 1, 'total': 1}, 'Angleterre': {'LOC': 1, 'total': 1}, 'MYSTÉRIEUX': {'ORG': 1, 'total': 1}, 'VOYAGEUR': {'ORG': 1, 'total': 1}, 'Madame': {'PER': 12, 'total': 12}, 'Turquie': {'LOC': 1, 'total': 1}, 'Pas-Perdus': {'LOC': 1, 'total': 1}, 'Mes paroles': {'MISC': 1, 'total': 1}, 'gare Saint-Lazare': {'LOC': 2, 'total': 2}, 'Guillaume Berlat': {'PER': 4, 'total': 4}, 'police de Rouen': {'LOC': 1, 'total': 1}, 'Saint-Lazare': {'LOC': 1, 'total': 1}, 'Vernon': {'LOC': 1, 'total': 1}, 'Saint-Pierre': {'LOC': 1, 'total': 1}, 'Oissel': {'LOC': 1, 'total': 1}, 'Saint-Étienne': {'LOC': 1, 'total': 1}, 'côte Sainte-Catherine': {'LOC': 1, 'total': 1}, 'mes bijoux': {'MISC': 1, 'total': 1}, 'Écoutez': {'PER': 2, 'total': 2}, 'Racontez': {'PER': 1, 'total': 1}, 'Donnez': {'PER': 1, 'total': 1}, 'Renaud': {'PER': 4, 'total': 4}, 'Georges Ardelle': {'PER': 1, 'total': 1}, 'Crédit Rouennais': {'ORG': 1, 'total': 1}, 'Berlat': {'PER': 3, 'total': 3}, 'la Seine': {'LOC': 1, 'total': 1}, 'le Havre': {'LOC': 1, 'total': 1}, 'Attendre': {'LOC': 1, 'total': 1}, 'bicyclette': {'LOC': 1, 'total': 1}, 'gare de Darnétal': {'LOC': 1, 'total': 1}, 'gare du Nord': {'LOC': 1, 'total': 1}, 'Amiens': {'LOC': 3, 'total': 3}, 'écoutez M. Berlat': {'PER': 1, 'total': 1}, 'Honoré Massol': {'PER': 2, 'total': 2}, 'Gaston Delivet': {'PER': 2, 'total': 2}, 'Moreau-Lepton': {'PER': 2, 'total': 2}, 'Modestes soutiens': {'ORG': 1, 'total': 1}, 'Delivet Gaston': {'PER': 1, 'total': 1}, 'Massol Honoré': {'PER': 1, 'total': 1}, 'Darnétal': {'ORG': 1, 'total': 1}, 'Delivet': {'PER': 3, 'total': 3}, 'Montérolier-Buchy': {'PER': 1, 'total': 1}, 'Clères': {'LOC': 1, 'total': 1}, 'Dieppe': {'LOC': 8, 'total': 8}, 'Delivet !': {'MISC': 1, 'total': 1}, 'du Nord': {'LOC': 2, 'total': 2}, 'Sapristi': {'LOC': 1, 'total': 1}, 'là-bas': {'LOC': 1, 'total': 1}, 'Massol': {'LOC': 3, 'total': 4, 'PER': 1}, 'Pierre Onfrey': {'PER': 5, 'total': 5}, 'rue Lafontaine': {'LOC': 2, 'total': 2}, 'Mme Delbois': {'PER': 1, 'total': 1}, 'Mme Renaud': {'PER': 3, 'total': 3}, 'Dorin': {'PER': 1, 'total': 1}, 'Cruelle': {'LOC': 1, 'total': 1}, 'Isle-Adam': {'LOC': 1, 'total': 1}, 'Enghien': {'LOC': 1, 'total': 1}, 'porte Bineau': {'LOC': 1, 'total': 1}, 'Buchy': {'LOC': 1, 'total': 1}, 'Havre': {'LOC': 2, 'total': 2}, 'COLLIER': {'ORG': 1, 'total': 1}, 'REINE': {'ORG': 1, 'total': 1}, "d'Autriche": {'LOC': 1, 'total': 1}, 'Billingstone': {'PER': 1, 'total': 1}, 'comtesse de Dreux-Soubise': {'LOC': 1, 'total': 1}, 'Collier de la Reine': {'PER': 6, 'total': 6}, 'Böhmer': {'PER': 3, 'total': 3}, 'Bassenge': {'PER': 2, 'total': 2}, 'Du Barry': {'PER': 1, 'total': 1}, 'Rohan-Soubise': {'PER': 1, 'total': 1}, 'Marie-Antoinette': {'PER': 2, 'total': 2}, 'reine de France': {'PER': 1, 'total': 1}, 'Jeanne de Valois': {'PER': 2, 'total': 2}, 'comtesse de la Motte': {'LOC': 1, 'total': 1}, 'Rétaux de Villette': {'PER': 2, 'total': 2}, 'Villette': {'LOC': 1, 'total': 1}, 'Motte': {'LOC': 1, 'total': 1}, 'Italie': {'LOC': 1, 'total': 1}, 'Gaston de Dreux-Soubise': {'PER': 1, 'total': 1}, 'Rohan-Guéménée': {'LOC': 1, 'total': 1}, 'Jefferys': {'PER': 1, 'total': 1}, 'Dreux-Soubise': {'MISC': 3, 'total': 4, 'ORG': 1}, 'Palais de Castille': {'LOC': 1, 'total': 1}, 'Christian': {'PER': 1, 'total': 1}, 'comte de Dreux': {'PER': 1, 'total': 1}, 'Cardinal': {'PER': 2, 'total': 2}, 'Collier': {'LOC': 2, 'total': 2}, 'M. Valorbe': {'PER': 3, 'total': 5, 'MISC': 2}, 'M. de Dreux': {'PER': 6, 'total': 6}, 'Henriette': {'PER': 15, 'total': 15}, 'Raoul': {'PER': 3, 'total': 3}, 'Madame de Dreux': {'PER': 1, 'total': 1}, 'Mme de Dreux': {'PER': 5, 'total': 5}, 'Sommée': {'LOC': 1, 'total': 1}, 'Suresnes': {'LOC': 1, 'total': 1}, 'Anquety': {'PER': 2, 'total': 2}, 'Péchard': {'LOC': 1, 'total': 1}, 'la France': {'LOC': 1, 'total': 1}, 'souleva': {'LOC': 1, 'total': 1}, 'M. de Dreux-Soubise': {'PER': 1, 'total': 1}, 'Essaville': {'LOC': 1, 'total': 1}, 'Bochas': {'LOC': 1, 'total': 1}, 'Floriani': {'PER': 13, 'total': 16, 'LOC': 3}, 'Sicile': {'LOC': 1, 'total': 1}, 'général marquis de Rouzières': {'PER': 1, 'total': 1}, 'M. de Rouzières': {'PER': 1, 'total': 1}, 'Palerme': {'LOC': 2, 'total': 2}, 'Sherlock Holmes': {'PER': 1, 'total': 1}, 'Complice': {'PER': 1, 'total': 1}, 'Provoquer': {'PER': 1, 'total': 1}, 'Avouez': {'PER': 1, 'total': 1}, 'Combien': {'PER': 1, 'total': 5, 'LOC': 4}, 'Le Collier de la Reine': {'MISC': 1, 'total': 1}, 'SEPT': {'ORG': 1, 'total': 1}, 'CŒUR': {'LOC': 1, 'total': 1}, 'Cascade': {'LOC': 1, 'total': 1}, 'Saint-Martin': {'PER': 3, 'total': 3}, 'Jean Daspry': {'PER': 6, 'total': 6}, 'Daspry': {'PER': 16, 'total': 38, 'LOC': 22}, 'Maroc': {'LOC': 2, 'total': 2}, 'Neuilly': {'LOC': 2, 'total': 2}, 'boulevard Maillot': {'LOC': 4, 'total': 4}, 'Antoine': {'PER': 3, 'total': 3}, 'verrou': {'LOC': 1, 'total': 1}, 'Urgente': {'PER': 1, 'total': 1}, 'Sinon': {'PER': 2, 'total': 2}, 'Mes doigts': {'MISC': 1, 'total': 1}, 'Saisir': {'MISC': 1, 'total': 1}, 'Impossible': {'PER': 2, 'total': 2}, 'Sagesse': {'PER': 1, 'total': 1}, 'Allais-je': {'PER': 1, 'total': 1}, 'Supplice intolérable': {'MISC': 1, 'total': 1}, 'Spectacle incompréhensible !': {'MISC': 1, 'total': 1}, 'Bacchus': {'MISC': 1, 'total': 1}, 'Gil Blas': {'PER': 3, 'total': 3}, 'Obsédé': {'ORG': 1, 'total': 1}, 'brun': {'PER': 1, 'total': 1}, 'Georges Andermatt': {'PER': 2, 'total': 2}, 'rue de Berry': {'LOC': 1, 'total': 1}, 'de France': {'LOC': 3, 'total': 3}, 'mail-coach': {'PER': 1, 'total': 1}, 'Mme Andermatt': {'PER': 15, 'total': 15}, 'Andermatt': {'PER': 5, 'total': 6, 'MISC': 1}, '- M. Andermatt': {'PER': 1, 'total': 1}, 'M. Andermatt': {'PER': 20, 'total': 20}, 'Étienne Varin': {'PER': 4, 'total': 4}, 'Alfred Varin': {'PER': 5, 'total': 5}, 'rue de': {'LOC': 1, 'total': 1}, 'Varin': {'PER': 35, 'total': 35}, 'Suisses': {'LOC': 1, 'total': 1}, 'rue de Provence': {'LOC': 1, 'total': 1}, 'frères Varin': {'PER': 3, 'total': 3}, 'Le Sept de cœur !': {'MISC': 1, 'total': 1}, 'Amirauté anglaise': {'LOC': 1, 'total': 1}, 'Salvator': {'LOC': 1, 'total': 8, 'PER': 7}, 'Louis Lacombe': {'PER': 25, 'total': 25}, 'Lausanne': {'LOC': 1, 'total': 1}, 'H. Georges Andermatt': {'PER': 1, 'total': 1}, 'le Comptoir des Métaux': {'MISC': 1, 'total': 1}, 'hôtel Andermatt': {'LOC': 1, 'total': 1}, 'Que M. Andermatt': {'LOC': 1, 'total': 1}, 'Madame Andermatt': {'PER': 1, 'total': 1}, 'Russie': {'LOC': 1, 'total': 1}, 'Salvator !': {'MISC': 1, 'total': 1}, 'cailloux': {'LOC': 1, 'total': 1}, 'soyez': {'MISC': 1, 'total': 1}, 'Neuf heures': {'MISC': 1, 'total': 1}, 'Alfred': {'PER': 1, 'total': 1}, 'Monsieur Andermatt': {'PER': 5, 'total': 5}, 'Lacombe': {'LOC': 1, 'total': 1}, 'Livide': {'PER': 1, 'total': 1}, 'von Lieben': {'PER': 2, 'total': 2}, 'Ahuri': {'LOC': 1, 'total': 1}, 'Oh !': {'MISC': 1, 'total': 1}, 'Mets-toi à ma place': {'MISC': 1, 'total': 1}, 'M. Durand': {'PER': 1, 'total': 1}, 'Dupont': {'LOC': 1, 'total': 1}, 'Imbécile': {'MISC': 1, 'total': 1}, 'serrure secrète': {'LOC': 1, 'total': 1}, 'Charlemagne': {'PER': 1, 'total': 1}, 'Mon Dieu !': {'MISC': 1, 'total': 1}, 'État': {'LOC': 3, 'total': 3}, 'COFFRE': {'MISC': 1, 'total': 1}, 'MADAME IMBERT': {'PER': 1, 'total': 1}, 'Berthier': {'LOC': 1, 'total': 1}, 'Courcelles': {'LOC': 1, 'total': 1}, 'Porte-Maillot': {'LOC': 1, 'total': 1}, 'Villiers': {'LOC': 1, 'total': 1}, 'bras-le-corps': {'LOC': 1, 'total': 1}, 'Grande-Armée': {'LOC': 1, 'total': 1}, 'Ludovic Imbert': {'PER': 3, 'total': 3}, 'M. Imbert': {'PER': 1, 'total': 1}, 'Imbert': {'MISC': 7, 'total': 10, 'PER': 3}, 'Montmartre': {'LOC': 2, 'total': 2}, 'Brawford': {'LOC': 6, 'total': 6}, "place de l'Étoile": {'LOC': 1, 'total': 1}, 'Ludovic': {'LOC': 10, 'total': 12, 'PER': 2}, 'Gervaise': {'LOC': 9, 'total': 11, 'PER': 2}, 'Monsieur Lupin': {'PER': 3, 'total': 4, 'MISC': 1}, 'Sur-le-champ': {'LOC': 1, 'total': 1}, 'Grouvel': {'PER': 1, 'total': 1}, 'Rente': {'LOC': 3, 'total': 3}, 'objecta Lupin': {'PER': 1, 'total': 1}, 'Extérieure': {'LOC': 1, 'total': 1}, 'Minuit': {'MISC': 1, 'total': 1}, 'murmura Lupin': {'PER': 1, 'total': 1}, 'Villes': {'LOC': 1, 'total': 2, 'MISC': 1}, 'Suez': {'LOC': 1, 'total': 1}, 'Avais': {'MISC': 1, 'total': 1}, 'ÉTAIENT': {'ORG': 1, 'total': 1}, 'abasourdi': {'PER': 1, 'total': 1}, 'Savez': {'MISC': 1, 'total': 1}, 'André Brawford': {'PER': 1, 'total': 1}, 'Brawford !': {'MISC': 1, 'total': 1}, 'la leçon': {'MISC': 1, 'total': 1}, 'hein': {'PER': 1, 'total': 1}, 'NOIRE': {'MISC': 1, 'total': 1}, 'avenue Hoche': {'LOC': 2, 'total': 2}, 'docteur Harel': {'PER': 2, 'total': 2}, 'besogne': {'LOC': 2, 'total': 2}, 'Voyons': {'LOC': 1, 'total': 2, 'PER': 1}, '- Commençons': {'MISC': 1, 'total': 1}, 'Inutile': {'PER': 1, 'total': 1}, 'Mon brave Lupin': {'PER': 1, 'total': 1}, 'H': {'PER': 1, 'total': 1}, 'Pouvez': {'PER': 1, 'total': 1}, 'lettre R ?': {'MISC': 1, 'total': 1}, 'L': {'PER': 2, 'total': 2}, 'Devanne dégringola': {'PER': 1, 'total': 1}, 'Seigneur': {'PER': 1, 'total': 1}, 'H tournoie': {'LOC': 1, 'total': 1}, 'Mlle de Tancarville': {'PER': 1, 'total': 1}, 'Devanne abasourdi': {'PER': 1, 'total': 1}, 'Traité des serrures': {'MISC': 1, 'total': 1}, 'Voyez': {'LOC': 1, 'total': 1}, 'M. Velmont': {'PER': 1, 'total': 1}, 'Édouard': {'PER': 1, 'total': 1}, 'Monsieur Devanne': {'MISC': 1, 'total': 1}, 'Creative Commons BY-SA': {'MISC': 1, 'total': 1}, 'licence GNU': {'MISC': 1, 'total': 1}, 'Wikisource': {'MISC': 1, 'total': 1}, 'http://fr.wikisource.org/wiki/Aide:Signaler_une_erreur': {'LOC': 1, 'total': 1}}

                
                # This sorts the dictionnary by the number of total occurence across all labels, key: "total"
                sorted_output = sorted(entities.items(), key=lambda x: x[1]["total"], reverse=True)
                # prints out in csv file
                for key, value in sorted_output:
                    # prinlen(value))
                    
                    # write one row for the total amount of occurences
                    writer.writerow({'entity': key, 
                                    'label': "total", 
                                    'occurence': value["total"]})

                    #write one row per label attributed to the entity // one row per item in the dict
                    for k, val in value.items():
                        if k != 'total':

                            # label = [k for k in value.keys() if k != "total"]
                            # occurence = [(k, val) for k, val in value.items() if k != "total"]
                            writer.writerow({'entity': key, 
                                            'label': k, 
                                            'occurence': val})


            csvfile.close()


